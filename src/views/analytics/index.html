<div id="analytics" class="px-2">
    <div class="page-header sm:flex items-center justify-between">
        <div class="flex items-end">
            <p class="karla-bold text-3xl" style="color:#1e1c26;">{{$t('analytics') | capitalize}}</p>
            <p class="karla text-lg mb-1 ml-2" style="color:#1e1c26;">({{dateFilterDisp}})</p>
        </div>
        <div class="flex items-center justify-end">
            <v-select v-if="analytics.length" @input="applyFilters" v-model="analytic" :options="analytics" label="name" class="mr-2" style="min-width: 200px; background:white;"/>
            <feather-icon
                    @click="showFilter"
                    class="p-2 shadow-drop w-10 rounded-lg d-theme-dark-bg cursor-pointer mr-2"
                    icon="FilterIcon"
            />
            <vs-button style="border-radius: 6px" @click="saveAnalyticsActive=true" :disabled="filters.template.length==0 && canSave">{{$t('save')}}</vs-button>
        </div>
    </div>
    <div class="video-launcher mb-base">
      <a href="#" @click="howtoTemplate">{{ $t("Watch this video to see how it works") }}</a>
    </div>
    <b-tabs v-model="activeTab" @input="getData">
        <b-tab-item :label="$t('compliance')" class="compliance">
            <div class="row m-0 mb-5">
                <b-tag v-for="(filter, key) in filters"
                       v-if="filter.length > 0"
                       @close="filters[key] = []"
                       :key="key"
                       attached
                       :closable="key != 'date'"
                       aria-close-label="Close tag"
                       class="mr-2"
                >
                    <vs-icon icon-pack="feather" :icon="key == 'date' ? 'icon-calendar' : key == 'template' ? 'icon-layers' : key == 'users' ? 'icon-user' : key == 'teams' ? 'icon-users' : 'icon-settings'" />
                    <span v-if="key != 'date'">
                        {{ getFilterName(filter, key) }}
                    </span>
                    <span v-else>
                        {{ filter == 'today' ? $t('today') : (filter.charAt(0).toUpperCase() + filter.slice(1)) }}
                    </span>
                </b-tag>
                <span class="cursor-pointer" @click="removeFlters">
                    <vs-icon icon-pack="fa" icon="fa-eraser" />
                    {{ $t('clean_all') }}
                </span>
            </div>
            <div class="row w-100 m-0 mb-5 justify-content-between sum">
                <div class="col-md-4 pl-0">
                    <div class="h-100 bg-white row m-0 align-items-center">
                        <div class="col-4 h-100 row justify-content-center align-items-center">
                            <div class="icon-bg row justify-content-center align-items-center" style="background-color: #cfecf5">
                                <vs-icon icon-pack="feather" icon="icon-tablet" size="20px" color="#3980f6" />
                            </div>
                        </div>
                        <div class="col-8">
                            <small class="text-muted">{{ $t("failed_non_failed") }}</small>
                            <h3 class="h3">{{ complianceRate }}</h3>
                        </div>
                    </div>

                </div>
                <div class="col-md-4 pl-0">
                    <div class="h-100 bg-white row m-0 align-items-center">
                        <div class="col-4 h-100 row justify-content-center align-items-center">
                            <div class="icon-bg row justify-content-center align-items-center" style="background-color: #e3d9ff">
                                <vs-icon icon-pack="feather" icon="icon-map-pin" size="20px" color="#7166ed" />
                            </div>
                        </div>
                        <div class="col-8">
                            <small class="text-muted">{{ $t('least_loc') }}</small>
                            <h3 class="h3">{{ leastPerformingLocation.name }}</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 pl-0">
                    <div class="h-100 bg-white row m-0 align-items-center">
                        <div class="col-4 h-100 row justify-content-center align-items-center">
                            <div class="icon-bg row justify-content-center align-items-center" style="background-color: #ffeec1">
                                <vs-icon icon-pack="feather" icon="icon-users" size="20px" color="#F4BE41" />
                            </div>
                        </div>
                        <div class="col-8">
                            <small class="text-muted">{{ $t('least_team') }}</small>
                            <h3 class="h3">{{ leastPerformingTeam.name }}</h3>
                        </div>
                    </div>
                </div>
            </div>
            <template v-if="!compliancePerTemplates.length && !compliancePerLocationsFiltered.length">
                <vx-card>
                    <div class="flex w-full mt-base">
                        <div
                                class="vx-col flex items-center flex-col sm:w-1/2 md:w-3/5 lg:w-3/4 xl:w-1/2 mx-auto text-center sm:mt-base mt-0"
                                style="min-height:500px;"
                        >
                            <img
                                    :src="require('../../assets/images/pages/report/empty-doc.svg')"
                                    class="mx-auto mb-4 cursor-pointer"
                                    @click="showFilter"
                            />
                            <h3
                                    class="mt-base text-grey"
                            >{{ $t('select_options') }}</h3>
                        </div>
                    </div>
                </vx-card>
            </template>
            <div class="compliance-per-templates w-100 m-0 mb-5 bg-white p-5 br-8" v-if="compliancePerTemplates.length">
                <p class="font-weight-bold">{{ $t('compliance_per_templates') }}</p>
                <b-table
                        :data="compliancePerTemplates"
                        icon-pack="fa"
                        sort-icon="chevron-down"
                        default-sort-direction="asc"
                        paginated
                >
                    <b-table-column field="title" :label="$t('template')" sortable v-slot="props">
                        {{ props.row.content.templateTitle }}
                    </b-table-column>
                    <b-table-column field="templateUsage" :label="$t('template usage')" sortable v-slot="props">
                        {{ 1 }}
                    </b-table-column>
                    <b-table-column field="tasksType" :label="$t('tasks_type')" sortable v-slot="props">
                        {{ 'Scheduled' }}
                    </b-table-column>
                    <b-table-column field="totalTasks" :label="$t('total_tasks')" sortable v-slot="props">
                        {{ props.row.totalTasks }}
                    </b-table-column>
                    <b-table-column field="failedTasks" :label="$t('failed_tasks')" sortable v-slot="props">
                        {{ props.row.failedTasks }}
                    </b-table-column>
                    <b-table-column field="compliance" :label="$t('compliance')" sortable v-slot="props">
                        {{ props.row.compliance}}
                    </b-table-column>
                </b-table>

            </div>
            <div class="compliance-per-locations w-100 m-0 bg-white p-5 br-8" v-if="compliancePerLocationsFiltered.length">
                <p class="font-weight-bold mb-3">{{ $t('compliance_per_locations') }}</p>
                <b-table
                        :data="compliancePerLocationsFiltered"
                        icon-pack="fa"
                        sort-icon="chevron-down"
                        default-sort-direction="asc"
                        paginated
                >
                    <b-table-column field="name" :label="$t('location')" sortable v-slot="props">
                        {{ props.row.name }}
                    </b-table-column>
                    <b-table-column field="totalTasks" :label="$t('total_tasks')" sortable v-slot="props">
                        {{ props.row.totalTasks }}
                    </b-table-column>
                    <b-table-column field="tasksType" :label="$t('failed_tasks')" sortable v-slot="props">
                        {{ props.row.failedTasks }}
                    </b-table-column>
                    <b-table-column field="compliance" :label="$t('compliance')" sortable v-slot="props">
                        {{ ((props.row.totalTasks - props.row.failedTasks) / props.row.totalTasks * 100).toFixed(2) + ' %' }}
                    </b-table-column>
                </b-table>
            </div>
        </b-tab-item>
        <b-tab-item :label="$t('overdue tasks')" class="overdue-tasks">
            <div class="row m-0 mb-5">
                <b-tag v-for="(filter, key) in filters"
                       v-if="filter.length > 0"
                       @close="filters[key] = []"
                       :key="key"
                       attached
                       :closable="key != 'date'"
                       aria-close-label="Close tag"
                       class="mr-2"
                >
                    <vs-icon icon-pack="feather" :icon="key == 'date' ? 'icon-calendar' : key == 'template' ? 'icon-layers' : key == 'users' ? 'icon-user' : key == 'teams' ? 'icon-users' : 'icon-settings'" />
                    <span v-if="key != 'date'">
                        {{ getFilterName(filter, key) }}
                    </span>
                    <span v-else>
                        {{ filter | capitalize }}
                    </span>
                </b-tag>
                <span class="cursor-pointer" @click="removeFlters">
                    <vs-icon icon-pack="fa" icon="fa-eraser" />
                    {{ $t('clean_all') }}
                </span>
            </div>
            <div class="row w-100 m-0 mb-5 justify-content-between sum">
                <div class="col-md-4 pl-0">
                    <div class="h-100 bg-white row m-0 align-items-center">
                        <div class="col-4 h-100 row justify-content-center align-items-center">
                            <div class="icon-bg row justify-content-center align-items-center" style="background-color: #cfecf5">
                                <vs-icon icon-pack="feather" icon="icon-tablet" size="20px" color="#3980f6" />
                            </div>
                        </div>
                        <div class="col-8">
                            <small class="text-muted">{{ $t('overdue_tasks') }}</small>
                            <h3 class="h3">{{ (overdueTasks.length / allTasks * 100).toFixed(2) + '%'}}</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 pl-0">
                    <div class="h-100 bg-white row m-0 align-items-center">
                        <div class="col-4 h-100 row justify-content-center align-items-center">
                            <div class="icon-bg row justify-content-center align-items-center" style="background-color: #e3d9ff">
                                <vs-icon icon-pack="feather" icon="icon-map-pin" size="20px" color="#7166ed" />
                            </div>
                        </div>
                        <div class="col-8">
                            <small class="text-muted">{{ $t('high_overdue_tasks_loc') }}</small>
                            <h3 class="h3">{{ failureRateLocation }}</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 pl-0">
                    <div class="h-100 bg-white row m-0 align-items-center">
                        <div class="col-4 h-100 row justify-content-center align-items-center">
                            <div class="icon-bg row justify-content-center align-items-center" style="background-color: #ffeec1">
                                <vs-icon icon-pack="feather" icon="icon-users" size="20px" color="#F4BE41" />
                            </div>
                        </div>
                        <div class="col-8">
                            <small class="text-muted">{{ $t('high_overdue_tasks_team') }}</small>
                            <h3 class="h3">{{ failureTasksTeam }}</h3>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row w-100 m-0 mb-5 justify-content-between">
                <div class="col-md-6 pl-0">
                    <div class="h-100 bg-white m-0 p-5 br-8">
                        <p class="font-weight-bold mb-4">{{ $t('overdue_tasks_per_loc') }}</p>
                        <div class="row h-100 w-100 m-0 align-items-center" v-if="pieChart1Options.labels.length">
                            <div class="col-7 pl-0">
                                <div class="border-bottom d-flex justify-content-between p-2" v-for="(data, key) in pieChart1Options.quantities" :key="key" v-if="locations.includes(key)">
                                    <div class="font-weight-bold d-flex align-items-center">
                                        <div class="mr-2" :style="{height: '10px', width: '10px', borderRadius: '50%', backgroundColor: pieChart1Options.colors[key]}"></div>
                                        <span>{{ data.name }}</span>
                                    </div>
                                    <div>{{ data.count }} ({{ (data.count / pieChart1Options.series.reduce((a, b) => a + b, 0) * 100).toFixed(2)}}%)</div>
                                </div>
                            </div>
                            <div class="col-5">
                                <apexchart v-if="activeTab === 1" type="donut" :options="pieChart1Options" :series="pieChart1Options.series"></apexchart>
                            </div>
                        </div>
                        <div class="h-100 d-flex justify-content-center align-items-center mb-6" v-else>
                            {{ $t('no_data') }}
                        </div>
                    </div>
                </div>
                <div class="col-md-6 pl-0">
                    <div class="h-100 bg-white m-0 p-5 br-8">
                        <p class="font-weight-bold mb-4">{{ $t('overdue_tasks_by_time') }}</p>
                        <apexchart v-if="barChart1Options.series[0].data.length" :options="barChart1Options" :series="barChart1Options.series"></apexchart>
                        <div class="h-100 d-flex justify-content-center align-items-center mb-6" v-else>
                            {{ $t('no_data') }}
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white m-0 p-5 br-8 w-100 mb-5" style="max-height: 442px">
                <div class="row m-0 justify-content-between align-items-center">
                    <p class="font-weight-bold">{{ $t('overdue_tasks_by_loc') }}</p>
                </div>
                <apexchart v-if="activeTab === 1" height="90%" :options="barChart2Options" :series="barChart2Options.series"></apexchart>
            </div>
            <div class="bg-white m-0 p-5 br-8 w-100 mb-5" style="max-height: 442px">
                <div class="row m-0 align-items-center">
                    <p class="font-weight-bold mr-5">{{ $t('overdue_tasks_by_templates') }}</p>
                </div>
                <apexchart v-if="activeTab === 1" height="90%" :options="barChart3Options" :series="barChart3Options.series"></apexchart>
            </div>
            <div class="bg-white m-0 p-5 br-8 w-100 mb-5">
                <div class="row m-0 mb-3 justify-content-between align-items-center">
                    <p class="font-weight-bold mr-5">{{ $t('overdue_tasks_list') }}</p>
                    <b-button type="is-primary is-light">
                        <vs-icon icon-pack="feather" icon="icon-download"></vs-icon>
                    </b-button>
                </div>
                <b-table
                    :data="overdueTasksFiltered"
                    icon-pack="fa"
                    sort-icon="chevron-down"
                    default-sort-direction="asc"
                    paginated
                >
                    <b-table-column field="location" :label="$t('location')" sortable v-slot="props">
                        {{ props.row.location || ' - ' }}
                    </b-table-column>
                    <b-table-column field="team" :label="$t('team')" sortable v-slot="props">
                        {{ props.row.team }}
                    </b-table-column>
                    <b-table-column field="template" :label="$t('template')" sortable v-slot="props">
                        {{ props.row.template }}
                    </b-table-column>
                    <b-table-column field="deadline" label="Date" sortable v-slot="props">
                        {{ props.row.deadline }}
                    </b-table-column>
                    <b-table-column field="overdue" :label="$t('overdue')" sortable v-slot="props">
                        {{ props.row.overdue + ' days' }}
                    </b-table-column>
                    <b-table-column field="status" :label="$t('status')" sortable v-slot="props">
                        {{ props.row.status }}
                    </b-table-column>
                </b-table>
            </div>
        </b-tab-item>

        <b-tab-item :label="$t('failed answers')" class="failed-answers">
            <div class="row m-0 mb-5">
                <b-tag v-for="(filter, key) in filters"
                       v-if="filter.length > 0"
                       @close="filters[key] = []"
                       :key="key"
                       attached
                       :closable="key != 'date'"
                       aria-close-label="Close tag"
                       class="mr-2"
                >
                    <vs-icon icon-pack="feather" :icon="key == 'date' ? 'icon-calendar' : key == 'template' ? 'icon-layers' : key == 'users' ? 'icon-user' : key == 'teams' ? 'icon-users' : 'icon-settings'" />
                    <span v-if="key != 'date'">
                        {{ getFilterName(filter, key) }}
                    </span>
                    <span v-else>
                        {{ filter | capitalize }}
                    </span>
                </b-tag>
                <span class="cursor-pointer" @click="removeFlters">
                    <vs-icon icon-pack="fa" icon="fa-eraser" />
                    {{ $t('clean_all') }}
                </span>
            </div>
            <div class="row w-100 m-0 mb-5 justify-content-between sum">
                <div class="col-md-4 pl-0">
                    <div class="h-100 bg-white row m-0 align-items-center">
                        <div class="col-4 h-100 row justify-content-center align-items-center">
                            <div class="icon-bg row justify-content-center align-items-center" style="background-color: #cfecf5">
                                <vs-icon icon-pack="feather" icon="icon-tablet" size="20px" color="#3980f6" />
                            </div>
                        </div>
                        <div class="col-8">
                            <small class="text-muted">{{ $t('failed_non_failed') }}</small>
                            <h3 class="h3">{{ failedAnswersCompliance }}</h3>
                        </div>
                    </div>

                </div>
                <div class="col-md-4 pl-0">
                    <div class="h-100 bg-white row m-0 align-items-center">
                        <div class="col-4 h-100 row justify-content-center align-items-center">
                            <div class="icon-bg row justify-content-center align-items-center" style="background-color: #e3d9ff">
                                <vs-icon icon-pack="feather" icon="icon-map-pin" size="20px" color="#7166ed" />
                            </div>
                        </div>
                        <div class="col-8">
                            <small class="text-muted">{{ $t('high_failure_answers_loc') }}</small>
                            <h3 class="h3">{{ failureAnswersLocation }}</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 pl-0">
                    <div class="h-100 bg-white row m-0 align-items-center">
                        <div class="col-4 h-100 row justify-content-center align-items-center">
                            <div class="icon-bg row justify-content-center align-items-center" style="background-color: #ffeec1">
                                <vs-icon icon-pack="feather" icon="icon-users" size="20px" color="#F4BE41" />
                            </div>
                        </div>
                        <div class="col-8">
                            <small class="text-muted">{{ $t('least_performing_team') }}</small>
                            <h3 class="h3">{{ fat || 'N / A' }}</h3>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row w-100 m-0 mb-5 justify-content-between">
                <div class="col-md-6 pl-0">
                    <div class="h-100 bg-white m-0 p-5 br-8">
                        <p class="font-weight-bold mb-4">{{ $t('failed_answers_by_loc') }}</p>
                        <div class="row h-100 w-100 m-0 align-items-center" v-if="pieChart2Options.labels.length">
                            <div class="col-7 pl-0">
                                <div class="border-bottom d-flex justify-content-between p-2" v-for="(data, key) in pieChart2Options.quantities" :key="key" v-if="locations.includes(key)">
                                    <div class="font-weight-bold d-flex align-items-center">
                                        <div class="mr-2" :style="{height: '10px', width: '10px', borderRadius: '50%', backgroundColor: pieChart2Options.colors[key]}"></div>
                                        <span>{{ data.name }}</span>
                                    </div>
                                    <div>{{ data.count }} ({{ (data.count / pieChart2Options.series.reduce((a, b) => a + b, 0)  * 100).toFixed(2)}}%)</div>
                                </div>
                            </div>
                            <div class="col-5">
                                <apexchart type="donut" :options="pieChart2Options" :series="pieChart2Options.series"></apexchart>
                            </div>
                        </div>
                        <div v-else class="h-100 d-flex justify-content-center align-items-center">
                            {{ $t('no_data') }}
                        </div>
                    </div>
                </div>
                <div class="col-md-6 pl-0">
                    <div class="h-100 bg-white m-0 p-5 br-8">
                        <p class="font-weight-bold mb-4">{{ $t('failed_answers_by_time') }}</p>
                        <apexchart v-if="barChart4Options.series[0].data.length" :options="barChart4Options" :series="barChart4Options.series"></apexchart>
                        <div class="h-100 d-flex justify-content-center align-items-center mb-6" v-else>
                            {{ $t('no_data') }}
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <b-collapse
                        class="card mb-3 show br-8"
                        animation="slide"
                        v-for="(log, i) of failedAnswerLogsFiltered"
                        :key="i"
                        :open="isOpen == i"
                        @open="isOpen = i"
                >
                    <div
                            slot="trigger"
                            slot-scope="props"
                            class="card-header row m-0 align-items-center br-8 p-5"
                            role="button"
                    >
                        <span class="font-weight-bold col-2">{{ log.template }}</span>
                        <div class="col-8 p-0" style="height: 2px; background-color: #ebebeb"></div>
                        <div class="col-2 text-right">
                            <b-tag rounded class="mr-3 font-weight-bold">{{ log.logs[0].questions.length > 1 ? log.logs[0].questions.length + ' questions' : log.logs[0].questions.length + ' question' }}</b-tag>
                            <b-icon class="expand-panel-icon" pack="fa" :icon="props.open ? 'sort-up' : 'sort-down'"></b-icon>
                        </div>
                    </div>
                    <div class="card-content" v-for="(lg, j) in log.logs" :key="j">
                        <div class="content" v-for="(qn, k) in lg.questions" :key="k">
                            <p class="font-weight-bold">{{ qn.title }}</p>
                            <b-table
                                    :data="qn.answers"
                                    :paginated="qn.answers.length > 5"
                                    :per-page="5"
                                    icon-pack="fa"
                                    sort-icon="chevron-down"
                                    default-sort-direction="asc"
                            >
<!--                                <template scope="props" v-if="getType(props.row.ref.type.id) !== undefined">-->
                                    <b-table-column field="location" :label="$t('location')" sortable>
                                        {{ log.location || ' - ' }}
                                    </b-table-column>

                                    <b-table-column field="teams" :label="$t('team')" sortable v-slot="props">
                                        {{ qn.team ? qn.team.join(', ') : log.team.join(', ') }}
                                    </b-table-column>

                                    <b-table-column field="template" :label="$t('template')" sortable v-slot="props">
                                        {{ log.template }}
                                    </b-table-column>

                                    <b-table-column field="section" label="Section" sortable v-slot="props">
                                        {{ qn.section || ' - ' }}
                                    </b-table-column>

                                    <b-table-column field="title" label="Question" sortable v-slot="props">
                                        <h5 style="display: inline; font-size: 12px;font-weight: 500;color: #1e1c26;opacity: 0.78;">
                                            {{ props.row.ref.title }}
                                            <div v-if="getType(props.row.ref.type.id).content == 'temperature'">
                                                <span v-if="props.row.ref.type.tempUnit" class="text-success">
                                                    ({{ props.row.ref.type.tempUnit }})&nbsp;
                                                </span>
                                                <span v-else class="text-success">
                                                    (℃)&nbsp;
                                                </span>
                                            </div>
                                            <span v-if="props.row.ref.mandatory" class="text-danger">*</span>
                                        </h5>
                                    </b-table-column>

                                    <b-table-column field="answers.title" label="Answer" sortable v-slot="props">
                                        <span class="text-danger" v-if="!props.row.loged">---</span>
                                        <span
                                                v-else-if="getType(props.row.ref.type.id).content=='automatic date and time stamp' || getType(props.row.ref.type.id).content=='date'"
                                        >
                                            {{ convDate(props.row.value) | moment('DD MMMM ,YYYY @ HH[h]mm') }}
                                        </span>
                                        <div v-else-if="getType(props.row.ref.type.id).content=='date time'">
                                            <span v-if="props.row.ref.type.dateType=='Date'">
                                                {{ props.row.value | moment('DD MMMM ,YYYY') }}
                                            </span>
                                            <span v-else-if="props.row.ref.type.dateType=='Time'">
                                                {{ props.row.value | moment('HH:mm') }}
                                            </span>
                                            <span v-else-if="props.row.ref.type.dateType=='Date & Time'">
                                                {{ props.row.value | moment('DD MMMM ,YYYY @ HH[h]mm') }}
                                            </span>
                                        </div>
                                        <star-rating
                                                v-else-if="getType(props.row.ref.type.id).content == 'star'"
                                                :star-size="25"
                                                :read-only="true"
                                                :increment="0.1"
                                                :fixed-points="1"
                                                :rating="props.row.value"
                                        ></star-rating>
                                        <span
                                                v-else-if="getType(props.row.ref.type.id).content == 'automatic user stamp' && getUserInfo(props.row.value) != undefined"
                                        >
                                            {{ getUserInfo(props.row.value).name | capitalize }}
                                        </span>
                                        <div
                                                v-else-if="getType(props.row.ref.type.id).content=='short answer' || getType(props.row.ref.type.id).content=='paragraph'"
                                                class="text-primary"
                                                style="font-style: italic; white-space: pre-wrap; word-break: break-word; "
                                        >
                                            {{ props.row.value }}
                                        </div>
                                        <vs-checkbox
                                                v-else-if="getType(props.row.ref.type.id).content=='checkbox'"
                                                disabled="true"
                                                :value="props.row.value"
                                        ></vs-checkbox>
                                        <div v-else-if="getType(props.row.ref.type.id).content=='items'">
                                            <span v-if="getItemInfo(props.row.value)!=undefined">
                                                {{ getItemInfo(props.row.value).name }}
                                            </span>
                                        </div>
                                        <div v-else-if="getType(props.row.ref.type.id).content=='users'">
                                            <span v-if="getUserInfo(props.row.value)!=undefined">
                                                {{ getUserInfo(props.row.value).name | capitalize }}
                                            </span>
                                        </div>
                                        <div v-else-if="getType(props.row.ref.type.id).content=='teams'">
                                            <span v-if="getTeamInfo(props.row.value)!=undefined">
                                                {{ getTeamInfo(props.row.value).name | capitalize }}
                                            </span>
                                        </div>
                                        <div v-else-if="getType(props.row.ref.type.id).type=='attachments'">
                                            <a
                                                    :href="image.url"
                                                    target="_blank"
                                                    v-for="(image,imgIndex) in props.row.images"
                                                    :key="'img_'+imgIndex"
                                                    class="ml-1"
                                                    style="float: left"
                                            >
                                                <img
                                                        :src="image.url"
                                                        style="max-width:50px;max-height:50px;"
                                                        class="rounded-lg"
                                                />
                                            </a>
                                        </div>
                                        <div
                                                v-else-if="getType(props.row.ref.type.id).content=='instruction'"
                                                style="font-size: 12px;color: #86848a;  font-weight: normal; white-space: pre-wrap; word-break: break-word;"
                                        >
                                            {{ props.row.ref.type.instruction }}
                                        </div>
                                        <div v-else-if="getType(props.row.ref.type.id).content=='temperature'">
                                            <span
                                                    :class="calcTemperatureColor(props.row.ref.action , props.row.value)"
                                                    v-if="props.row.value!==undefined"
                                            >{{ props.row.value }}</span>
                                        </div>
                                        <div v-else-if="getType(props.row.ref.type.id).content=='signature'">
                                            <img
                                                    :src="props.row.value.url"
                                                    v-if="props.row.value.url!==undefined && props.row.value.url!=''"
                                            />
                                        </div>
                                        <div v-else-if="getType(props.row.ref.type.id).type=='closed answers'">
                                            <span :class="[{'text-danger':props.row.ref.type.failedAnswer == props.row.value }]"
                                                  v-if="getType(props.row.ref.type.id).group=='global'">
                                                {{$t(props.row.value)}}</span>
                                            <span :class="[{'text-danger':props.row.ref.type.failedAnswer == props.row.value }]" v-else>
                                                {{ props.row.value | capitalize }}
                                            </span>
                                        </div>
                                        <span v-else>
                                            {{ props.row.value }}
                                        </span>
                                    </b-table-column>
<!--                                </template>-->
                            </b-table>
                        </div>
                    </div>
                </b-collapse>
            </div>
        </b-tab-item>

        <b-tab-item :label="$t('temperature')" class="temperature">
            <div class="row m-0 mb-5">
                <b-tag v-for="(filter, key) in filters"
                       v-if="filter.length > 0"
                       @close="filters[key] = []"
                       :key="key"
                       attached
                       :closable="key != 'date'"
                       aria-close-label="Close tag"
                       class="mr-2"
                >
                    <vs-icon icon-pack="feather" :icon="key == 'date' ? 'icon-calendar' : key == 'template' ? 'icon-layers' : key == 'users' ? 'icon-user' : key == 'teams' ? 'icon-users' : 'icon-settings'" />
                    <span v-if="key != 'date'">
                        {{ getFilterName(filter, key) }}
                    </span>
                    <span v-else>
                        {{ filter | capitalize }}
                    </span>
                </b-tag>
                <span class="cursor-pointer" @click="removeFlters">
                    <vs-icon icon-pack="fa" icon="fa-eraser" />
                    {{ $t('clean_all') }}
                </span>
            </div>
            <template v-if="templates.length==0">
                <vx-card>
                    <div class="flex w-full mt-base">
                        <div
                                class="vx-col flex items-center flex-col sm:w-1/2 md:w-3/5 lg:w-3/4 xl:w-1/2 mx-auto text-center sm:mt-base mt-0"
                                style="min-height:500px;"
                        >
                            <img
                                    :src="require('../../assets/images/pages/report/empty-doc.svg')"
                                    class="mx-auto mb-4 cursor-pointer"
                                    @click="showFilter"
                            />
                            <h3
                                    class="mt-base text-grey"
                            >{{ $t('select_options') }}</h3>
                        </div>
                    </div>
                </vx-card>
            </template>
            <div class="bg-white m-0 p-5 br-8 w-100 mb-5" style="max-height: 460px" v-else v-for="(template,index) in templates" :key="index">
                <TemperatureSection :template="template" :date="filters.date" />
            </div>
            <div class="bg-white m-0 p-5 br-8 w-100 mb-5" style="max-height: 460px">
            </div>
        </b-tab-item>

        <b-tab-item :label="$t('alerts')" class="alerts">
            <div class="row m-0 mb-5">
                <b-tag v-for="(filter, key) in filters"
                       v-if="filter.length > 0"
                       @close="filters[key] = []"
                       :key="key"
                       attached
                       :closable="key != 'date'"
                       aria-close-label="Close tag"
                       class="mr-2"
                >
                    <vs-icon icon-pack="feather" :icon="key == 'date' ? 'icon-calendar' : key == 'template' ? 'icon-layers' : key == 'users' ? 'icon-user' : key == 'teams' ? 'icon-users' : 'icon-settings'" />
                    <span v-if="key != 'date'">
                        {{ getFilterName(filter, key) }}
                    </span>
                    <span v-else>
                        {{ filter | capitalize }}
                    </span>
                </b-tag>
                <span class="cursor-pointer" @click="removeFlters">
                    <vs-icon icon-pack="fa" icon="fa-eraser" />
                    {{ $t('clean_all') }}
                </span>
            </div>
            <div class="row w-100 m-0 mb-5 justify-content-between sum">
                <div class="col-md-4 pl-0">
                    <div class="h-100 bg-white row m-0 align-items-center">
                        <div class="col-4 h-100 row justify-content-center align-items-center">
                            <div class="icon-bg row justify-content-center align-items-center" style="background-color: #cfecf5">
                                <vs-icon icon-pack="feather" icon="icon-tablet" size="20px" color="#3980f6" />
                            </div>
                        </div>
                        <div class="col-8">
                            <small class="text-muted">{{ $t('number_of_alerts') }}</small>
                            <h4 class="h4">{{ alertsFiltered.length }}</h4>
                        </div>
                    </div>

                </div>
                <div class="col-md-4 pl-0">
                    <div class="h-100 bg-white row m-0 align-items-center">
                        <div class="col-4 h-100 row justify-content-center align-items-center">
                            <div class="icon-bg row justify-content-center align-items-center" style="background-color: #e3d9ff">
                                <vs-icon icon-pack="feather" icon="icon-map-pin" size="20px" color="#7166ed" />
                            </div>
                        </div>
                        <div class="col-8">
                            <small class="text-muted">{{ $t('most_alerts_loc') }}</small>
                            <h4 class="h4">{{ biggestAlertsLocation }}</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 pl-0">
                    <div class="h-100 bg-white row m-0 align-items-center">
                        <div class="col-4 h-100 row justify-content-center align-items-center">
                            <div class="icon-bg row justify-content-center align-items-center" style="background-color: #ffeec1">
                                <vs-icon icon-pack="feather" icon="icon-users" size="20px" color="#F4BE41" />
                            </div>
                        </div>
                        <div class="col-8">
                            <small class="text-muted">{{ $t('most_alerts_team') }}</small>
                            <h4 class="h4">{{ biggestAlertsTeam }}</h4>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white m-0 p-5 br-8 w-100 mb-5">
                <div class="row m-0 mb-4 justify-content-between align-items-center">
                    <p class="font-weight-bold">{{ $t('alerts_log') }}</p>
                    <b-button type="is-primary is-light">
                        <vs-icon icon-pack="feather" icon="icon-download"></vs-icon>
                    </b-button>
                </div>
                <b-table
                        :data="alertsFiltered"
                        icon-pack="fa"
                        sort-icon="chevron-down"
                        default-sort-direction="asc"
                        paginated
                >
                    <b-table-column field="title" label="Alert name" sortable v-slot="props">
                        {{ props.row.title }}
                    </b-table-column>
                    <b-table-column field="location" :label="$t('location')" sortable v-slot="props">
                        {{ props.row.location ? props.row.location.name : ' - ' }}
                    </b-table-column>
                    <b-table-column field="teams" :label="$t('team')" sortable v-slot="props">
                        {{ props.row.teams.join(', ') || ', ' }}
                    </b-table-column>
                    <b-table-column field="color" label="Type" sortable v-slot="props">
                        <span :style="{color: props.row.color == 'danger' ? 'red' : props.row.color == 'success' ? 'green' : props.row.color == 'warning' ? 'orange' : ''}" v-if="props.row.color">{{ props.row.color }}</span>
                        <span :style="{color: props.row.alertType == 'warning' ? 'orange' : props.row.alertType == 'danger' ? 'red' : props.row.alertType == 'success' ? 'green' : ''}" v-else>{{ props.row.alertType }}</span>
                    </b-table-column>
                    <b-table-column field="text" label="Message" sortable v-slot="props">
                        {{ props.row.text }}
                    </b-table-column>
                </b-table>
            </div>
        </b-tab-item>

    </b-tabs>
    <analy-filter
            @chnFilter="chnFilter"
            :filters="filters"
            :isSidebarActive="filterSidebar"
            @closeSidebar="filterSidebar = false"
    />
    <vs-prompt
            :is-valid="analyticsName!=''"
            :title="$t('save analytics')"
            :accept-text="$t('save') | capitalize"
            :cancel-text="$t('cancel') | capitalize"
            @accept="saveAnalytics"
            :active.sync="saveAnalyticsActive"
    >
        <VuePerfectScrollbar class="p-0 mb-10" :settings="settings" style="height:20rem;">
            <div class="vx-row">
                <div class="vx-col w-full mb-4" v-if="analytic!=null">
                    <vs-switch v-model="updateFlag">
                        <span slot="on">{{$t('update')}}</span>
                        <span slot="off">{{$t('save')}}</span>
                    </vs-switch>
                </div>
                <div class="vx-col w-full mb-4">
                    <label class="font-semibold">{{$t("name")}}</label>
                    <vs-input v-model="analyticsName" class="w-full" :placeholder="$t('name')" />
                </div>
                <div class="vx-col w-full">
                    <label class="font-semibold">{{$t("visible to")}}</label>
                    <div class="flex items-center mt-2">
                        <div v-for="(visibleItem,vIndex) in visibles" :key="vIndex">
                            <div class="flex items-center ml-4 cursor-pointer" @click="visible=visibleItem.key">
                                <vs-icon icon="radio_button_checked" size="25px" color="primary" v-if="visibleItem.key==visible"/>
                                <vs-icon icon="radio_button_unchecked" size="25px" v-else />
                                <span class="karla" :class="{'text-primary':visibleItem.key==visible}">{{$t(visibleItem.text)}}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="vx-col w-full mt-4" v-if="visible==1">
                    <label class="font-semibold">{{$t('teams')}}</label>
                    <v-select :reduce="teamItem=>teamItem.id" :options="teams" label="name" multiple v-model="team" />
                </div>
            </div>
        </VuePerfectScrollbar>
    </vs-prompt>
</div>